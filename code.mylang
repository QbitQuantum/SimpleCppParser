

using type string = System::UnicodeString;
using type w_string = System::WideString;

// using pointer ERequestError = function[void][__fastcall](var[TNetHTTPClient*], var[type[string]], var[LLinkWorkType], var[type[string]]);
// using pointer ERequestEvent = function[void][__fastcall](var[TNetHTTPClient*], var[type[string]] Link, var[LLinkWorkType]);
// using pointer ERequestObtainData = function[void][__fastcall](var[TObject*], var[type[string]], var[int]);

using access BaseRequest = OctetBaseLink::OctetBaseLinkRequest;
using access LinkConnection = link::connection;
using access LinkResponse = link::response;
using access LinkType = link::type;

var[const int] INDEX_INVALID = -1;
// base link class
class OctetBaseLink : OctetBaseNode {

private:

    // async request class
    class OctetBaseLinkRequest : TNetHTTPRequest {

    private:
        var[type[string]] __link;
        var[OctetBaseLink*] __parent;
        var[bool] __abort = false;
        var[int] __arg = INDEX_INVALID;

        function[void][__fastcall] _eventerror(var[TObject* const],  var[type[string]]);
        function[void][__fastcall] _eventcomplete(var[TObject* const], var[const _di_IHTTPResponse]);
        function[void][__fastcall] _eventreceive(var[TObject* const], var[__int64] AContentLength, var[__int64] AReadCount, var[bool&] Abort);

    public:

        var[type[string]] RequestTag;
        // pointer[ERequestObtainData] OnObtainData = nullptr;
        var[bool] Completed = false;

        __property Link = { __link };

        function[void][__fastcall] Get();
        function[void][__fastcall] Abort();

        function[void][__fastcall] OctetBaseLinkRequest(var[OctetBaseLink*], var[type[string]] RequestTag, var[type[string]] Link, var[ERequestObtainData], var[int] Argument = INDEX_INVALID);
    };

protected:

    // internal data
    function[bool][__fastcall] _start(var[LLinkWorkType], var[type[string]]);

    var[TNetHTTPClient*] __client = nullptr, __asyncclient = nullptr;
    var[LLinkWorkType] __work = lwIdle;

    var[type[string]] __host, __lastresult;

    var[int] 
        __contime = access[LinkConnection] timeout, 
        __restime = access[LinkResponse] timeout;

    var[int] 
        __contimeasync = access[LinkConnection] timeout_async, 
        __restimeasync = access[LinkResponse] timeout_async;
    var[int] 
        __lastcode = access[LinkResponse] timeout;

    // class init
    function[void][__fastcall] _init();

    // header methods
    function[void][__fastcall] _setheaders(TNetHTTPClient*, bool State);

    // internal events
    function[void][__fastcall] _eventerror(var[TObject* const],  var[type[string]]);
    function[void][__fastcall] _eventcomplete(var[TObject* const], var[const _di_IHTTPResponse]);
    function[void][__fastcall] _eventauth(var[TObject* const], var[TAuthTargetType] Target, var[type[string]], var[type[string]], var[type[string]]&, var[type[string]], var[bool&], var[TAuthPersistenceType&]);

static:
    function[void][__fastcall] _eventexecute(var[TObject* const],  var[type[string]]);

public:

    // variables
    var[type[string]] DefaultLink, UpdateLink, UserIdent, MachineIdent;

    var[bool] LocalLinking = false, InputCache = false, OutputCache = false;

    // events
    // pointer[ERequestEvent] OnStart = nullptr, OnComplete = nullptr;
    // pointer[ERequestError] OnError = nullptr;

    // base network methods

    function[type[string]][__fastcall] Read(var[type[string]], var[int] Type = access[LinkType] critical);
    // function[void][__fastcall] Read(var[type[string]], pointer[ERequestObtainData], var[type[string]] RequestTag, var[int] Argument = INDEX_INVALID);
    // function[void][__fastcall] Cache(var[type[string]] Link, pointer[ERequestObtainData] Event, var[type[string]] RequestTag, var[int] Argument = INDEX_INVALID);
    function[type[string]][__fastcall] Cache(type[string] Link);
    function[void][__fastcall] Stop(var[type[string]] RequestTag = "");
    function[bool][__fastcall] Write(var[type[string]], var[type[string]] Data, var[TStringStream*] Response = NULL);
    // function[void][__fastcall] Write(var[type[string]], var[type[string]], pointer[ERequestObtainData] Event, var[type[string]] RequestTag, var[int] Argument = INDEX_INVALID);
    function[bool][__fastcall] Delete(var[type[string]]);
    function[bool][__fastcall] Auth(var[type[string]], var[type[string]] User, var[type[string]] Pass, var[TStringStream*] Response = NULL);
    function[type[string]][__fastcall] ResponseCode();
    function[type[string]][__fastcall] ResponseCode(var[int], var[type[string]]);
    function[void][__fastcall] ClearCache(var[int] AgeDays);
    function[type[string]][__fastcall] ClearCache(var[bool] Download);

    // properties
    __property Client = { __asyncclient };
    __property ConnectionTimeout = { __contime };
    __property ResponseTimeout = { __restime };
    __property ConnectionTimeoutAsync = { __contimeasync };
    __property ResponseTimeoutAsync = { __restimeasync };
    __property LastResponseCode = { __lastcode, __lastcode };
    __property ConnectionHost = { __host };
    __property ConnectionTask = { nullptr, __host };

    function[void][__fastcall] OctetBaseLink(
        var[TComponent*], 
        var[int] ConnectionTimeout = access[LinkConnection] timeout, 
        var[int] ResponseTimeout = access[LinkResponse] timeout, 
        var[int] ConnectionTimeoutAsync = access[LinkConnection] timeout_async, 
        var[int] ResponseTimeoutAsync = access[LinkResponse] timeout_async);
};

// function[void][__fastcall] OctetBaseLink::OctetBaseLinkRequest::Abort()  {
function[void][__fastcall] access[BaseRequest] Abort()  {
    var[const int] number = 1;
};

/*
class Base<T, K> : Derive<T> {
    function[T][__fastcall] Stop(K RequestTag);
    var[K] Data;
    var[K*] PointData = nullptr;
};
*/

class Base {

public:
    var[int] PublicBaseData;
    function[void] [virtual] PublicMethodBase();
    function[void] [] Base();
static:
    var[int] StaticBaseData;
    function[void][] StaticMethodBase();
}

class Derived : Base {

public:
    function[void] [override] PublicMethodBase();
    function[void] [] Derived();
    class Math {
    static:
        function[void] [] PublicMethodBase();
    }
static:
    var[int] StaticData = 1;
    function[void][] StaticMethodBase();

private:
    var[int] m_pivate = 1;

}

function[void] [] PublicMethodBase() { };

function[int][] main () {
    
    var[Derived*] un = new Derived();

    PublicMethodBase();            // текущий контекст -> глобальный
    Derived::StaticMethodBase();       // статический
    Derived::Math::PublicMethodBase(); // статический вложенного класса
    
    un.PublicMethodBase();           // Объект напрямую
    un->PublicMethodBase();          // виртуальный через указатель  
        
    delete un;
    return 0;
};

/*
function[int][] main (var[int] argc, var[char*] argv) {
    return 0;
};

function[int][] main () {
    
    return int(); // Равен хз, ну пускай -1;
};
*/